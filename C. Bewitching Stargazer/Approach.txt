This solution can be easily coded recursively but the constraints don't allow that. If we draw the recursion tree we will observe that at a time the length of the segments in a level is same. So for a level all the segments will add on to the luck or else none of them will. So we just need to consider the sum of each level. So the sum of the first level is just the midpoint of the segment. Then for each segment the sum gets doubled. So we just need to interate through all the segment lengths and maintain the sum for each level. Then whenever the segment is even, we will just add that sum to our final answer. This could be done in O(log n) which is fast enough for 1e9.
